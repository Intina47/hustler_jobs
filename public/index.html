<!DOCTYPE html>
<html lang="en">
<head>
   <!-- meta -->
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Job Listings</title>
    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- css -->
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stickybits/3.7.6/stickybits.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- job listing and search bar in the same row -->
  
        <div class="row">
            <div class="col-md-8">
              <a href="/" style="text-decoration: none;">
                <h1 class="about mb-4" style="display: flex;">Job Listings</h1>
              </a>
            </div>
          </div>
          <div class="header">
            
          <div id="sticky-container" class="sticky">
            <div class="toggle-container">
                <span class="toggle-label">Dark Mode</span>
                <label class="toggle">
                    <input class="toggle-checkbox" type="checkbox" id="darkModeToggle">
                    <span class="toggle-icon" id="toggleIcon"><i class="fa-solid fa-moon"></i></span>
                </label>
            </div>
          </div>
  
          <div class="row">
                <input id="searchInput" type="text" placeholder="Search" style="width: 100%; height: 30px; border-radius: 5px; border: 1px solid #ccc; padding: 5px 10px; margin-left: 10px; font-size: 20px;">
                <i type="submit" class="search-icon fa-solid fa-search"></i>
          </div>

        </div>
        <div id="jobListings"></div>
    </div>
    <script>
      //load more button
const loadMoreButton = document.createElement('button');
loadMoreButton.textContent = 'Load More';
loadMoreButton.classList.add('load-more-button');
loadMoreButton.addEventListener('click', function() {
  fetchJobs(currentPage + 1);
});
        //load jobs from jobs.json
        let currentPage = 1;
        function fetchJobs(page){
          fetch(`/jobs?page=${page}`)
          .then(function(response){
            return response.json();
          })
          //if error
          .catch(function(error){
            console.log('Sorry an error occured\n',error);
          })
          //if success
          .then(function(jobsData){
            if (jobsData.length === 0) {
              loadMoreButton.style.display = 'none';
              return;
            }
            displayJobs(jobsData.jobs);
            currentPage = jobsData.currentPage;

            if (currentPage >= jobsData.totalPages) {
              loadMoreButton.style.display = 'none';
            }else{
              loadMoreButton.style.display = 'block';
            }
          });
        }
//fetch the initial page of jobs
fetchJobs(currentPage);

function displayJobs(jobs) {
  var jobListingsContainer = document.getElementById('jobListings');
  jobs.forEach(function(job) {
    var jobListing = document.createElement('div');
    jobListing.className = 'job-listing';

    var jobTitle = document.createElement('div');
    jobTitle.className = 'job-title';
    jobTitle.textContent = job.title;

    var jobLink = document.createElement('a');
    jobLink.className = 'job-link';
    jobLink.textContent = 'View Details';
    jobLink.href = `/pdf/${encodeURIComponent(job.file_name)}`; // Set the href directly to the PDF URL

    jobListing.appendChild(jobTitle);
    jobListing.appendChild(jobLink);

    jobListingsContainer.appendChild(jobListing);
    //append "load more" button to the page
document.getElementById("jobListings").appendChild(loadMoreButton);
  });
}


                // Toggle dark mode
        var darkModeToggle = document.getElementById('darkModeToggle');
        var toggleIcon = document.getElementById('toggleIcon');

        darkModeToggle.addEventListener('change', function () {
            if (this.checked) {
                document.body.classList.add('dark-mode');
                toggleIcon.innerHTML = '<i class="fa-solid fa-moon"></i>'; // Moon icon
            } else {
                document.body.classList.remove('dark-mode');
                toggleIcon.innerHTML = '<i class="fa-solid fa-moon"></i>'; // Sun icon
            }
        });

        window.addEventListener('scroll', function() {
    var stickyElement = document.querySelector('.sticky');
    var stickyElementTop = stickyElement.getBoundingClientRect().top;
    
    if (stickyElementTop === 0) {
        stickyElement.classList.add('sticky-background');
    } else {
        stickyElement.classList.remove('sticky-background');
    }
});

      
    </script>
    <script src="/src/search.js"></script>

</body>
</html>
